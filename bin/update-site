#!/bin/bash

set -e
# Make sure there are no uncommitted changes
if [[ `git status --porcelain` ]]; then
  echo "Changes in the directory. Fix this first!"
  exit
fi

# Go to master branch
git checkout master

# Fetch changes from jekyll branch
git reset --hard jekyll

# Create a hidden dir for the output
mkdir .output

# Build the jekyll stuff
jekyll build --destination .output

# Move the jekyll files to the root directory
rm -rf * # Clean everything except hidden stuff.
mv .output/* .
rmdir .output


# Push
git add -A :/
git commit -m "Content update"
git push -f origin master

# Go back to jekyll branch
git checkout jekyll
