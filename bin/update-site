#!/bin/bash

set -e
# Make sure there are no uncommitted changes
if [[ `git status --porcelain` ]]; then
  echo "Changes in the directory. Fix this first!"
  exit
fi

# Build the jekyll site
jekyll build

# Make a copy of the master branch
git clone -b master . .temp/
cd .temp/

# Copy the files
/bin/cp -rf ../_site/* .

# Commit
git add -A :/
git commit -m "Content update"
git push origin master

# Remove temp stuff
cd ..
rm -Rf .temp/
